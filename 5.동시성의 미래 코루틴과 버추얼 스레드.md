# 5.동시성의 미래 코루틴과 버추얼 스레드


## 전통적 웹 방식
![image](https://github.com/user-attachments/assets/d32ad201-2727-4286-a530-4d0ff8e05aa9)
- 스레드가 블록킹되는 특징
- Spring MVC가 가지고 있는 특징

![image](https://github.com/user-attachments/assets/990a526a-1b81-4574-873f-7b2a198f1fee)
- 성능 문제와 직결됨
- 일정 스레드를 미리 생성 후 사용하는 방식으로 동시성 제어를 했었음.
- 그러나 스레드 풀의 개수만큼만 사용할 수 있으며, 스레드 풀만큼 사용하지 않으면 자원이 낭비되는 문제도 있음

### 전통적인 방식의 정리
  ![image](https://github.com/user-attachments/assets/9cc08a09-d108-41b2-b47e-155fdfee5812)

## 리액티브 프로그래밍
![image](https://github.com/user-attachments/assets/d76a609d-3980-49d1-b048-32220cab55cd)
> 콜벡헬 = 콜백 지옥(callback hell): 콜백 함수를 중첩하여 사용할 때 코드가 복잡해지고 가독성이 저하되는 현상
![image](https://github.com/user-attachments/assets/97c26d0d-d447-4631-a339-f26e9a8c3863)
- 콜백헬 문제 해결
- 손쉽게 비동기 문제 해결
- 실시간 데이터 스트리밍에 대한 유연한 처리 가능
- 대규모 트래픽 처리에도 유용

<img src="https://github.com/user-attachments/assets/1a505fdf-a790-4c54-bd05-12562a9f2cb4" width="470px" height=""></img>
<img src="https://github.com/user-attachments/assets/9b640e7c-89c7-4f0c-b577-9c758498f571" width="470px" height=""></img>
![image](https://github.com/user-attachments/assets/293743ee-6c39-45ef-abef-24580af7a075)
![image](https://github.com/user-attachments/assets/084659ed-d744-4dc4-b12e-b8eab59805d0)
- webflux에서 블로킹 API가 호출되면 성능 하락이 큰 폭으로 생긴다.

### 리액티브 프로그래밍 정리
![image](https://github.com/user-attachments/assets/c7d899b8-c93c-41dd-b5cb-78b68fe1be4c)

## 코틀린 코루틴
- 코틀린에서 비동기 프로그래밍을 손쉽게 작성할 수 있게 도와주는 확장 라이브러리다.
![image](https://github.com/user-attachments/assets/c6ae0815-76f6-4da0-89b2-0f55e6cee7a8)
![image](https://github.com/user-attachments/assets/f9efd512-1926-49cb-84ab-67f1875befec)

### 리액티브 코드 -> 코루틴
![image](https://github.com/user-attachments/assets/52b456c2-60c9-4bc3-8ad3-86f45a9fa1c9)
- 전통적인 방식과 유사한 흐름으로 코드를 작성할 수 있다.
- 코루틴은 매우 가볍다.

![image](https://github.com/user-attachments/assets/2e0a2616-f9e2-4fb2-b6ea-aeefabaf50a9)
> 빨간색이 코루틴의 동작 방식에 대한 이미지
- 다수의 코루틴이 platform Thread에서 동작
- 코루틴간의 전환은 언어 레벨에서 이루어진다.

### 전통적인 방식의 스레드 100만개 생성 예제
![image](https://github.com/user-attachments/assets/aa6607eb-d17f-4646-93df-e3e33a6f7957)
![image](https://github.com/user-attachments/assets/a3da1c9d-496d-4e88-b6fe-641abdc7eacb)

### 코루틴에서 스레드 100만개
![image](https://github.com/user-attachments/assets/5772fe50-cd54-4811-bed9-c58d1c4e273b)



## 버추얼 스레드

## 코루틴과 버추얼 스레드의 통합
 

